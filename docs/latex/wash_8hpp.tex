\hypertarget{wash_8hpp}{}\section{/dcs/20/u2002000/4th\+Year\+Project/wash/include/wash.hpp File Reference}
\label{wash_8hpp}\index{/dcs/20/u2002000/4th\+Year\+Project/wash/include/wash.\+hpp@{/dcs/20/u2002000/4th\+Year\+Project/wash/include/wash.\+hpp}}


The public facing A\+PI for all Wash programs to be written with.  


{\ttfamily \#include $<$chrono$>$}\newline
{\ttfamily \#include $<$cassert$>$}\newline
{\ttfamily \#include $<$functional$>$}\newline
{\ttfamily \#include $<$optional$>$}\newline
{\ttfamily \#include $<$stdexcept$>$}\newline
{\ttfamily \#include $<$string$>$}\newline
{\ttfamily \#include $<$unordered\+\_\+map$>$}\newline
{\ttfamily \#include $<$vector$>$}\newline
{\ttfamily \#include \char`\"{}io.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}particle.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}particle\+\_\+data.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}util.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}vector.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}kernels.\+hpp\char`\"{}}\newline
\subsection*{Namespaces}
\begin{DoxyCompactItemize}
\item 
 \mbox{\hyperlink{namespacewash}{wash}}
\begin{DoxyCompactList}\small\item\em T\+O\+DO\+: Consider having this as a private header in W\+I\+S\+B/\+W\+S2\+S\+T/etc implementations. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \mbox{\hyperlink{wash_8hpp_ae03823afa0476d165a3e8aeeed0594da}{define\+Wash\+Force\+Kernel}}(kernel\+\_\+name,  particle\+\_\+name)
\begin{DoxyCompactList}\small\item\em Define a wash force kernel function with a name and particle parameter The force kernel iterates through all particles in the simulation and their neighbours. \end{DoxyCompactList}\item 
\#define \mbox{\hyperlink{wash_8hpp_aaebd5ab9cc432e0045423e9e8aeb52c6}{define\+Wash\+Void\+Kernel}}(kernel\+\_\+name)~void kernel\+\_\+name (void)
\begin{DoxyCompactList}\small\item\em Define a wash void kernel function with a given name. The void kernel is executed once every simulation loop. \end{DoxyCompactList}\item 
\#define \mbox{\hyperlink{wash_8hpp_aaab38d9050a72937ed82b9a68a09304c}{define\+Wash\+Update\+Kernel}}(kernel\+\_\+name,  particle\+\_\+name)~void kernel\+\_\+name (\mbox{\hyperlink{classwash_1_1Particle}{wash\+::\+Particle}}\& particle\+\_\+name)
\begin{DoxyCompactList}\small\item\em Define a wash update kernel function with a name and particle parameter The update kernel is executed once for every particle in the simulation every loop. \end{DoxyCompactList}\item 
\#define \mbox{\hyperlink{wash_8hpp_acf0cb8c952a42be96b3128d8da9408b4}{define\+Wash\+Reduction\+Kernel}}(kernel\+\_\+name,  particle\+\_\+name)~double kernel\+\_\+name (const \mbox{\hyperlink{classwash_1_1Particle}{wash\+::\+Particle}}\& particle\+\_\+name)
\begin{DoxyCompactList}\small\item\em Define a wash reduction kernel function with a name and particle parameter The reduction kernel returns a single value from each particle in the simulation. \end{DoxyCompactList}\item 
\#define \mbox{\hyperlink{wash_8hpp_a6f06a172af0125a56863cadbe6180af8}{wash\+For\+Each\+Neighbour}}(var\+\_\+name,  body)
\begin{DoxyCompactList}\small\item\em Define a for loop across the particle\textquotesingle{}s neighbourhood. This should only be used within a force kernel. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
uint64\+\_\+t \mbox{\hyperlink{namespacewash_ab59a4fff607c38a8cded277413cdafec}{wash\+::get\+\_\+max\+\_\+iterations}} ()
\begin{DoxyCompactList}\small\item\em Get the max iterations of the simulation. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{namespacewash_aeb7b287406244c8ab192d0524ad4da5b}{wash\+::set\+\_\+max\+\_\+iterations}} (const uint64\+\_\+t iterations)
\begin{DoxyCompactList}\small\item\em Set the max number of iterations. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{namespacewash_a24bef1df5fe5c24cd518f12885a51055}{wash\+::set\+\_\+bounding\+\_\+box}} (const double min, const double max, const bool periodic)
\begin{DoxyCompactList}\small\item\em Set the bounding box dimensions and periodicity type. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{namespacewash_a70aeb215881f159a7efb6da02e5e452b}\label{namespacewash_a70aeb215881f159a7efb6da02e5e452b}} 
void \mbox{\hyperlink{namespacewash_a70aeb215881f159a7efb6da02e5e452b}{wash\+::set\+\_\+bounding\+\_\+box}} (const double xmin, const double xmax, const double ymin, const double ymax, const double zmin, const double zmax, const bool x\+\_\+periodic, const bool y\+\_\+periodic, const bool z\+\_\+periodic)
\begin{DoxyCompactList}\small\item\em Set the bounding box dimensions and periodicity type in 3 dimensions. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{namespacewash_a6103b7efdcc3045c8d2aae4d5598e7ae}{wash\+::add\+\_\+force\+\_\+scalar}} (const std\+::string force)
\begin{DoxyCompactList}\small\item\em Add a scalar force to the simulation. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{namespacewash_a9f85f4ec09db604cb09806616365a5b8}{wash\+::add\+\_\+force\+\_\+vector}} (const std\+::string force)
\begin{DoxyCompactList}\small\item\em Add a n-\/dim vector force to the simulation. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{namespacewash_ae40d87ba5e1d4b16f1cc52932a030b3d}{wash\+::add\+\_\+variable}} (const std\+::string variable, double init\+\_\+value=0.\+0)
\begin{DoxyCompactList}\small\item\em Add a scalar variable to the simulation. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{namespacewash_a2bed8ccfb6599a8edd0eb88037d8c8af}{wash\+::add\+\_\+init\+\_\+update\+\_\+kernel}} (const Update\+FuncT func)
\begin{DoxyCompactList}\small\item\em Add an initialisation update kernel (will be executed for each particle) \end{DoxyCompactList}\item 
void \mbox{\hyperlink{namespacewash_a4aa9c050821f26f11d51e72a861a1102}{wash\+::add\+\_\+init\+\_\+void\+\_\+kernel}} (const Void\+FuncT func)
\begin{DoxyCompactList}\small\item\em Add an initialization void kernel to the simulation -\/ run once. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{namespacewash_a2ffa21a9e32d3ca6ce87def3e7db4837}{wash\+::add\+\_\+force\+\_\+kernel}} (const Force\+FuncT func)
\begin{DoxyCompactList}\small\item\em Add a force kernel to the simulation which will loop over the particles and their neighbourhood. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{namespacewash_abc27c958fb1156da77a1346c3559abc1}{wash\+::add\+\_\+update\+\_\+kernel}} (const Update\+FuncT func)
\begin{DoxyCompactList}\small\item\em Add an update kernel to the simulation which will loop over the particles. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{namespacewash_a730e8352e9361e6ef88fd4b4c21e7f8c}{wash\+::add\+\_\+reduction\+\_\+kernel}} (const Map\+FuncT map\+\_\+func, const Reduce\+Op reduce\+\_\+op, double $\ast$variable)
\begin{DoxyCompactList}\small\item\em Add a reduction kernel to the simulation which will loop over the particles. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{namespacewash_ab49fcc701f7afced2186465ba5cce978}{wash\+::add\+\_\+void\+\_\+kernel}} (const Void\+FuncT func)
\begin{DoxyCompactList}\small\item\em Add a void kernel to the simulation. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{namespacewash_abc2e79908c969eabb61a865c8f279d02}{wash\+::set\+\_\+default\+\_\+neighbor\+\_\+search}} (const unsigned max\+\_\+count)
\begin{DoxyCompactList}\small\item\em Set the neighborhood search to use the provided default which uses the smoothing length of the particle and returns at most max\+\_\+count neighbours. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{namespacewash_a49d266f2bd4daa1a1de50dab5a4250df}{wash\+::set\+\_\+neighbor\+\_\+search\+\_\+kernel}} (const Neighbors\+FuncT func, const unsigned max\+\_\+count)
\begin{DoxyCompactList}\small\item\em Sets the neighbourhood search to use a custom function. \end{DoxyCompactList}\item 
double \mbox{\hyperlink{namespacewash_a6c61472c6ffa0cb654bc9497292b7f30}{wash\+::get\+\_\+variable}} (const std\+::string \&variable)
\begin{DoxyCompactList}\small\item\em Get the value of a variable. \end{DoxyCompactList}\item 
double $\ast$ \mbox{\hyperlink{namespacewash_ad9a1f6575e74c6c12ddbae8d58c2b478}{wash\+::use\+\_\+variable}} (const std\+::string \&variable)
\begin{DoxyCompactList}\small\item\em Returns a reference to a variable useful for e.\+g. reduction kernels. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{namespacewash_a5045909b6d97db3d92cc44bfd5df70ee}{wash\+::set\+\_\+variable}} (const std\+::string \&variable, const double value)
\begin{DoxyCompactList}\small\item\em Set the value of a variable. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{namespacewash_a4c8a9913a535b341da9e72826916544b}{wash\+::start}} ()
\begin{DoxyCompactList}\small\item\em Get the vector of all particles in the simulation. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{namespacewash_a4ddbab848bef96e0fc69bf8e280d4775}{wash\+::set\+\_\+simulation\+\_\+name}} (const std\+::string name)
\begin{DoxyCompactList}\small\item\em Set the name of the simulation, used in IO. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{namespacewash_ad6de17b9a27f58f6245a68ede303e84b}{wash\+::set\+\_\+output\+\_\+file\+\_\+name}} (const std\+::string name)
\begin{DoxyCompactList}\small\item\em Set the output file name of the simulation. \end{DoxyCompactList}\item 
double \mbox{\hyperlink{namespacewash_aecf1c6d565098a830dfeb491a4638093}{wash\+::eucdist}} (const Particle \&p, const Particle \&q)
\begin{DoxyCompactList}\small\item\em T\+O\+DO\+: Move eucdist calculation to the paticle header? \end{DoxyCompactList}\item 
void \mbox{\hyperlink{namespacewash_a20a6940ce5a881482fe472ed704f177e}{wash\+::set\+\_\+particle\+\_\+count}} (const size\+\_\+t count)
\begin{DoxyCompactList}\small\item\em Set the number of particles to be used in the simulation. \end{DoxyCompactList}\item 
size\+\_\+t \mbox{\hyperlink{namespacewash_a3b281fefe2419e7bc1450029b0324ab8}{wash\+::get\+\_\+particle\+\_\+count}} ()
\begin{DoxyCompactList}\small\item\em Get the number of particles used in the simulation. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{namespacewash_a6b9608d3d8934431c9ab6af488992f10}{wash\+::set\+\_\+dimension}} (int dim)
\begin{DoxyCompactList}\small\item\em Set the dimensionality of the simulation. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{namespacewash_aaa75af8f4a35ef4b222eace2714ee9f8}\label{namespacewash_aaa75af8f4a35ef4b222eace2714ee9f8}} 
void \mbox{\hyperlink{namespacewash_aaa75af8f4a35ef4b222eace2714ee9f8}{wash\+::set\+\_\+io}} (const std\+::string format, size\+\_\+t output\+\_\+nth, bool timings=true)
\begin{DoxyCompactList}\small\item\em Set the IO parameters used for the simulation. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
The public facing A\+PI for all Wash programs to be written with. 

\begin{DoxyAuthor}{Authors}
Wash Project Group 
\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
0.\+1 
\end{DoxyVersion}
\begin{DoxyDate}{Date}
2024-\/02-\/12
\end{DoxyDate}
\begin{DoxyCopyright}{Copyright}
Copyright (c) 2024
\end{DoxyCopyright}
Implementations\+:
\begin{DoxyItemize}
\item wash (-\/\+D\+W\+A\+S\+H\+\_\+\+W\+S\+ER) -- Basic serial implementation. Particle class owns all it\textquotesingle{}s data, forces accessed though strings into per-\/particle map
\item wisb (-\/\+D\+W\+A\+S\+H\+\_\+\+W\+I\+SB) -- Data storage transformed from AoS to SoA. Particle class owns it\textquotesingle{}s global ID (size\+\_\+t wrapper), Forces are accessed through a global map with particle index lookup
\item ws2st (-\/\+D\+W\+A\+S\+H\+\_\+\+W\+E\+ST) -- D\+SL translation removing string keys, the particles own their ID similar to W\+I\+SB but forces are accessed directly through particle idx (generated by translations)
\item cstone (-\/\+D\+W\+A\+S\+H\+\_\+\+C\+S\+T\+O\+NE) -- Wash with multinode support. Particle class owns local and global ID (pair size\+\_\+t), Forces are accessed through global map with string lookups for indexing and per-\/particle indexing
\item wstone (-\/\+D\+W\+A\+S\+H\+\_\+\+W\+O\+NE) -- Integrating cornerstone into the ws2st implementation.
\end{DoxyItemize}

Dimensionality\+:
\begin{DoxyItemize}
\item Wash is a dimension agnostic A\+PI. Certain implementations have requirements due to technical reasons
\item The dimension of Simulation Vectors is controlled by the D\+IM define (-\/\+D\+D\+IM=d) 
\end{DoxyItemize}

\subsection{Macro Definition Documentation}
\mbox{\Hypertarget{wash_8hpp_ae03823afa0476d165a3e8aeeed0594da}\label{wash_8hpp_ae03823afa0476d165a3e8aeeed0594da}} 
\index{wash.\+hpp@{wash.\+hpp}!define\+Wash\+Force\+Kernel@{define\+Wash\+Force\+Kernel}}
\index{define\+Wash\+Force\+Kernel@{define\+Wash\+Force\+Kernel}!wash.\+hpp@{wash.\+hpp}}
\subsubsection{\texorpdfstring{define\+Wash\+Force\+Kernel}{defineWashForceKernel}}
{\footnotesize\ttfamily \#define define\+Wash\+Force\+Kernel(\begin{DoxyParamCaption}\item[{}]{kernel\+\_\+name,  }\item[{}]{particle\+\_\+name }\end{DoxyParamCaption})}

{\bfseries Value\+:}
\begin{DoxyCode}
\textcolor{keywordtype}{void} kernel\_name (\mbox{\hyperlink{classwash_1_1Particle}{wash::Particle}}& particle\_name, \(\backslash\)
    \textcolor{keyword}{const} std::vector<wash::Particle>::const\_iterator& begin, \(\backslash\)
    \textcolor{keyword}{const} std::vector<wash::Particle>::const\_iterator& end)
\end{DoxyCode}


Define a wash force kernel function with a name and particle parameter The force kernel iterates through all particles in the simulation and their neighbours. 


\begin{DoxyParams}{Parameters}
{\em kernel\+\_\+name} & Name of the kernel function \\
\hline
{\em particle\+\_\+name} & Name of the particle parameter \\
\hline
\end{DoxyParams}
\mbox{\Hypertarget{wash_8hpp_acf0cb8c952a42be96b3128d8da9408b4}\label{wash_8hpp_acf0cb8c952a42be96b3128d8da9408b4}} 
\index{wash.\+hpp@{wash.\+hpp}!define\+Wash\+Reduction\+Kernel@{define\+Wash\+Reduction\+Kernel}}
\index{define\+Wash\+Reduction\+Kernel@{define\+Wash\+Reduction\+Kernel}!wash.\+hpp@{wash.\+hpp}}
\subsubsection{\texorpdfstring{define\+Wash\+Reduction\+Kernel}{defineWashReductionKernel}}
{\footnotesize\ttfamily \#define define\+Wash\+Reduction\+Kernel(\begin{DoxyParamCaption}\item[{}]{kernel\+\_\+name,  }\item[{}]{particle\+\_\+name }\end{DoxyParamCaption})~double kernel\+\_\+name (const \mbox{\hyperlink{classwash_1_1Particle}{wash\+::\+Particle}}\& particle\+\_\+name)}



Define a wash reduction kernel function with a name and particle parameter The reduction kernel returns a single value from each particle in the simulation. 


\begin{DoxyParams}{Parameters}
{\em kernel\+\_\+name} & Name of the kernel \\
\hline
{\em particle\+\_\+name} & Name of the particle parameter \\
\hline
\end{DoxyParams}
\mbox{\Hypertarget{wash_8hpp_aaab38d9050a72937ed82b9a68a09304c}\label{wash_8hpp_aaab38d9050a72937ed82b9a68a09304c}} 
\index{wash.\+hpp@{wash.\+hpp}!define\+Wash\+Update\+Kernel@{define\+Wash\+Update\+Kernel}}
\index{define\+Wash\+Update\+Kernel@{define\+Wash\+Update\+Kernel}!wash.\+hpp@{wash.\+hpp}}
\subsubsection{\texorpdfstring{define\+Wash\+Update\+Kernel}{defineWashUpdateKernel}}
{\footnotesize\ttfamily \#define define\+Wash\+Update\+Kernel(\begin{DoxyParamCaption}\item[{}]{kernel\+\_\+name,  }\item[{}]{particle\+\_\+name }\end{DoxyParamCaption})~void kernel\+\_\+name (\mbox{\hyperlink{classwash_1_1Particle}{wash\+::\+Particle}}\& particle\+\_\+name)}



Define a wash update kernel function with a name and particle parameter The update kernel is executed once for every particle in the simulation every loop. 


\begin{DoxyParams}{Parameters}
{\em kernel\+\_\+name} & Name of the kernel \\
\hline
{\em particle\+\_\+name} & Name of the particle parameter \\
\hline
\end{DoxyParams}
\mbox{\Hypertarget{wash_8hpp_aaebd5ab9cc432e0045423e9e8aeb52c6}\label{wash_8hpp_aaebd5ab9cc432e0045423e9e8aeb52c6}} 
\index{wash.\+hpp@{wash.\+hpp}!define\+Wash\+Void\+Kernel@{define\+Wash\+Void\+Kernel}}
\index{define\+Wash\+Void\+Kernel@{define\+Wash\+Void\+Kernel}!wash.\+hpp@{wash.\+hpp}}
\subsubsection{\texorpdfstring{define\+Wash\+Void\+Kernel}{defineWashVoidKernel}}
{\footnotesize\ttfamily \#define define\+Wash\+Void\+Kernel(\begin{DoxyParamCaption}\item[{}]{kernel\+\_\+name }\end{DoxyParamCaption})~void kernel\+\_\+name (void)}



Define a wash void kernel function with a given name. The void kernel is executed once every simulation loop. 


\begin{DoxyParams}{Parameters}
{\em kernel\+\_\+name} & Name of the kernel function \\
\hline
\end{DoxyParams}
\mbox{\Hypertarget{wash_8hpp_a6f06a172af0125a56863cadbe6180af8}\label{wash_8hpp_a6f06a172af0125a56863cadbe6180af8}} 
\index{wash.\+hpp@{wash.\+hpp}!wash\+For\+Each\+Neighbour@{wash\+For\+Each\+Neighbour}}
\index{wash\+For\+Each\+Neighbour@{wash\+For\+Each\+Neighbour}!wash.\+hpp@{wash.\+hpp}}
\subsubsection{\texorpdfstring{wash\+For\+Each\+Neighbour}{washForEachNeighbour}}
{\footnotesize\ttfamily \#define wash\+For\+Each\+Neighbour(\begin{DoxyParamCaption}\item[{}]{var\+\_\+name,  }\item[{}]{body }\end{DoxyParamCaption})}

{\bfseries Value\+:}
\begin{DoxyCode}
\_Pragma(\textcolor{stringliteral}{"omp simd"})\(\backslash\)
    for (\textcolor{keyword}{auto} it = begin; it != end; it++) \{\(\backslash\)
        const \textcolor{keyword}{auto}& var\_name = *it;\(\backslash\)
        \{ body \}\(\backslash\)
    \}
\end{DoxyCode}


Define a for loop across the particle\textquotesingle{}s neighbourhood. This should only be used within a force kernel. 


\begin{DoxyParams}{Parameters}
{\em var\+\_\+name} & Variable name of the neighbour. Marked const. \\
\hline
{\em body} & Body of the loop, to be run for every neighbouring particle. \\
\hline
\end{DoxyParams}
